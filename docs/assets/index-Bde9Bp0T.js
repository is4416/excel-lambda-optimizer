(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const f of s)if(f.type==="childList")for(const o of f.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function e(s){const f={};return s.integrity&&(f.integrity=s.integrity),s.referrerPolicy&&(f.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?f.credentials="include":s.crossOrigin==="anonymous"?f.credentials="omit":f.credentials="same-origin",f}function n(s){if(s.ep)return;s.ep=!0;const f=e(s);fetch(s.href,f)}})();var Z=1,z=3,P={},U=[],H="http://www.w3.org/2000/svg",Q=t=>t,K=U.map,I=Array.isArray,w=typeof requestAnimationFrame<"u"?requestAnimationFrame:setTimeout,j=t=>{var r="";if(typeof t=="string")return t;if(I(t))for(var e=0,n;e<t.length;e++)(n=j(t[e]))&&(r+=(r&&" ")+n);else for(var e in t)t[e]&&(r+=(r&&" ")+e);return r},V=(t,r)=>{for(var e in{...t,...r})if(typeof(I(t[e])?t[e][0]:t[e])=="function")r[e]=t[e];else if(t[e]!==r[e])return!0},d=(t,r=U,e)=>{for(var n=[],s=0,f,o;s<t.length||s<r.length;s++)f=t[s],o=r[s],n.push(o&&o!==!0?!f||o[0]!==f[0]||V(o[1],f[1])?[o[0],o[1],(f&&f[2](),o[0](e,o[1]))]:f:f&&f[2]());return n},D=t=>t==null?t:t.key,k=(t,r,e,n,s,f)=>{if(r==="style")for(var o in{...e,...n})e=n==null||n[o]==null?"":n[o],o[0]==="-"?t[r].setProperty(o,e):t[r][o]=e;else r[0]==="o"&&r[1]==="n"?((t.events||(t.events={}))[r=r.slice(2)]=n)?e||t.addEventListener(r,s):t.removeEventListener(r,s):!f&&r!=="list"&&r!=="form"&&r in t?t[r]=n??"":n==null||n===!1?t.removeAttribute(r):t.setAttribute(r,n)},T=(t,r,e)=>{var n=t.props,s=t.type===z?document.createTextNode(t.tag):(e=e||t.tag==="svg")?document.createElementNS(H,t.tag,n.is&&n):document.createElement(t.tag,n.is&&n);for(var f in n)k(s,f,null,n[f],r,e);for(var o=0;o<t.children.length;o++)s.appendChild(T(t.children[o]=x(t.children[o]),r,e));return t.node=s},F=(t,r,e,n,s,f)=>{if(e!==n)if(e!=null&&e.type===z&&n.type===z)e.tag!==n.tag&&(r.nodeValue=n.tag);else if(e==null||e.tag!==n.tag)r=t.insertBefore(T(n=x(n),s,f),r),e!=null&&t.removeChild(e.node);else{var o,h,A,O,B=e.props,R=n.props,i=e.children,a=n.children,u=0,c=0,l=i.length-1,m=a.length-1;f=f||n.tag==="svg";for(var p in{...B,...R})(p==="value"||p==="selected"||p==="checked"?r[p]:B[p])!==R[p]&&k(r,p,B[p],R[p],s,f);for(;c<=m&&u<=l&&!((A=D(i[u]))==null||A!==D(a[c]));)F(r,i[u].node,i[u],a[c]=x(a[c++],i[u++]),s,f);for(;c<=m&&u<=l&&!((A=D(i[l]))==null||A!==D(a[m]));)F(r,i[l].node,i[l],a[m]=x(a[m--],i[l--]),s,f);if(u>l)for(;c<=m;)r.insertBefore(T(a[c]=x(a[c++]),s,f),(h=i[u])&&h.node);else if(c>m)for(;u<=l;)r.removeChild(i[u++].node);else{for(var y={},M={},p=u;p<=l;p++)(A=i[p].key)!=null&&(y[A]=i[p]);for(;c<=m;){if(A=D(h=i[u]),O=D(a[c]=x(a[c],h)),M[A]||O!=null&&O===D(i[u+1])){A==null&&r.removeChild(h.node),u++;continue}O==null||e.type===Z?(A==null&&(F(r,h&&h.node,h,a[c],s,f),c++),u++):(A===O?(F(r,h.node,h,a[c],s,f),M[O]=!0,u++):(o=y[O])!=null?(F(r,r.insertBefore(o.node,h&&h.node),o,a[c],s,f),M[O]=!0):F(r,h&&h.node,null,a[c],s,f),c++)}for(;u<=l;)D(h=i[u++])==null&&r.removeChild(h.node);for(var p in y)M[p]==null&&r.removeChild(y[p].node)}}return n.node=r},tt=(t,r)=>{for(var e in t)if(t[e]!==r[e])return!0;for(var e in r)if(t[e]!==r[e])return!0},x=(t,r)=>t!==!0&&t!==!1&&t?typeof t.tag=="function"?((!r||r.memo==null||tt(r.memo,t.memo))&&((r=t.tag(t.memo)).memo=t.memo),r):t:J(""),N=t=>t.nodeType===z?J(t.nodeValue,t):G(t.nodeName.toLowerCase(),P,K.call(t.childNodes,N),Z,t),G=(t,{key:r,...e},n,s,f)=>({tag:t,props:e,key:r,children:n,type:s,node:f}),J=(t,r)=>G(t,P,U,z,r),rt=(t,{class:r,...e},n=U)=>G(t,{...e,...r?{class:j(r)}:P},I(n)?n:[n]),et=({node:t,view:r,subscriptions:e,dispatch:n=Q,init:s=P})=>{var f=t&&N(t),o=[],h,A,O=i=>{h!==i&&((h=i)==null&&(n=e=B=Q),e&&(o=d(o,e(h),n)),r&&!A&&w(B,A=!0))},B=()=>t=F(t.parentNode,t,f,f=r(h),R,A=!1),R=function(i){n(this.events[i.type],i)};return(n=n((i,a)=>typeof i=="function"?n(i(h,a)):I(i)?typeof i[0]=="function"?n(i[0],i[1]):i.slice(1).map(u=>u&&u!==!0&&(u[0]||u)(n,u[1]),O(i[0])):O(i)))(s),n};function Y(t,r=[]){return t.forEach(e=>{Array.isArray(e)?Y(e,r):r.push(e)}),r}const v=(t,r,...e)=>typeof t=="function"?t(r,Y(e)):rt(t,r||{},Y(e).map(n=>typeof n=="string"||typeof n=="number"?J(n):n)),nt=(t,r)=>{const e="=+-*/(,";for(let n=r-1;n>=0;n--)if(e.indexOf(t[n])!==-1)return t.slice(n+1,r);return null},it=(t,r)=>{let e=!1,n=0,s=r;for(;s<t.length;){const f=t[s];if(f==='"'&&(e=!e),e){s++;continue}if(f==="("&&n++,f===")"&&(n--,n===0))return t.slice(r,s+1);s++}return t.slice(r,t.length)},ft=t=>{const r=[];let e=0,n=!1,s=1;for(let f=1;f<t.length-1;f++){const o=t[f];o==='"'&&(n=!n),!n&&(o==="("&&e++,o===")"&&e--,o===","&&e===0&&(r.push(t.slice(s,f).trim()),s=f+1))}return s<t.length-1&&r.push(t.slice(s,t.length-1).trim()),r},S=(t,r)=>{let e=t,n=[],s=[];const f={EOL:`
`,indentSize:2,spacingKeys:[{from:"=LAMBDA",to:"= LAMBDA"},{from:"===",to:" === "},{from:"!==",to:" !== "},{from:"==",to:" == "},{from:"!=",to:" != "},{from:"=+",to:" =+ "},{from:"=-",to:" =- "},{from:"=*",to:" =* "},{from:"=/",to:" =/ "},{from:"+",to:" + "},{from:"-",to:" - "},{from:"*",to:" * "},{from:"/",to:" / "},{from:"=",to:" = "},{from:",",to:", "}],argRules:[{name:"LAMBDA",breakRule:(i,a)=>!1,variable:(i,a)=>i!==a-1},{name:"LET",breakRule:(i,a)=>i%2===0,variable:(i,a)=>i%2===0&&i!==a-1},{name:"IF",breakRule:(i,a)=>i>0,variable:(i,a)=>!1},{name:"MAP",breakRule:(i,a)=>!0,variable:(i,a)=>!1},{name:"REDUCE",breakRule:(i,a)=>!0,variable:(i,a)=>!1},{name:"HSTACK",breakRule:i=>!0,variable:i=>!1}],skipFirstLAMBDA:!0,minify:!0,...r};e=(i=>{let a="",u=!1,c=0;for(;c<i.length-1;){if(i[c]==='"'&&(u=!u),u||i.slice(c,c+2)!=="//"){i[c]!==" "&&(a+=i[c]),c++;continue}const l=i.indexOf(f.EOL,c);c=l===-1?i.length:l}return a=a.split(f.EOL).map(l=>l.trim()).filter(Boolean).join(""),"="+a.slice(a.toUpperCase().indexOf("LAMBDA"))})(e),e=((i,a,u)=>{const c=f.argRules;let l=i,m=!1,p=f.skipFirstLAMBDA;for(let y=0;y<l.length;y++){const M=l[y];if(M==='"'&&(m=!m),m||M!=="(")continue;const _=nt(l,y)?.toUpperCase().trim();if(!_)continue;const L=it(l,y),g=c.find(b=>b.name===_);if(!g)continue;const C=ft(L);let E=!1;const q="("+C.map((b,$)=>(g.variable($,C.length)&&((g.name!=="LAMBDA"||!p)&&a.push(b),g.name==="LAMBDA"&&p&&u.push(b)),g.breakRule($,C.length)?(E=!0,f.EOL+b):b)).join(",")+(E?f.EOL:"")+")";g.name==="LAMBDA"&&(p=!1);const X=_.toUpperCase();l=l.slice(0,y-X.length)+X+q+l.slice(y+L.length)}return l})(e,s,n);const A=i=>{const a=l=>{let m=0;for(let p=0;p<l.length;p++)l[p]==="("&&m++,l[p]===")"&&m--;return m>0},u=i.split(f.EOL);let c=0;return u.map(l=>{l[0]===")"&&c--;const m=" ".repeat(Math.max(0,f.indentSize*c))+l;return a(l)&&c++,m}).join(f.EOL)};f.minify||(e=A(e));const O=i=>{let a="",u=!1,c=0;for(;c<i.length;){const l=i[c];l==='"'&&(u=!u);const m=f.spacingKeys.find(p=>i.length-c<p.from.length?!1:i.slice(c,c+p.from.length)===p.from);u||!m?(a+=l,c++):(a+=m.to,c=c+m.from.length)}return a};f.minify||(e=O(e));const B=(i,a)=>{let u="",c=!1,l=0;const m=" =+-*/,(){}"+f.EOL,p=L=>{for(let g=L;g<i.length;g++){const C=i[g];if(m.indexOf(C)!==-1)return i.slice(L,g)}return i.slice(L,i.length)},y=L=>{let g=L+1,C="";for(;g>0;)g--,C=String.fromCharCode(65+g%26)+C,g=Math.floor(g/26);return C},_=(()=>{const L=[],g=new Set(n.map(C=>C.toUpperCase()));for(let C=0,E;C<a.length;C++)for(E=0;;){const q=y(C+E);if(!g.has(q)){L.push(q),g.add(q);break}E++}return L})();for(;l<i.length;){const L=i[l],g=l===0?" ":i[l-1];if(L==='"'&&(c=!c),c||m.indexOf(g)===-1){u+=L,l++;continue}const C=p(l),E=a.indexOf(C);E!==-1?(u+=_[E],l+=a[E].length):(u+=L,l++)}return u};f.minify&&(e=B(e,s));const R=i=>{let a="";for(let u=0,c=!1;u<i.length;u++){const l=i[u];l==='"'&&(c=!c),(c||l!==f.EOL)&&(a+=l)}return a};return f.minify&&(e=R(e)),e},st=t=>[t,async r=>{const e=await fetch("./sampleCode.txt").then(n=>{if(!n.ok)throw new Error("errorr loadText");return n.text()});r(n=>({...n,code:e}))}],ct=(t,r)=>{const e=r.currentTarget;return e?{...t,code:e.value}:t},W=(t,r)=>{const e=r.currentTarget;return e?{...t,options:{...t.options,[e.name]:e.checked}}:t},at=t=>({...t,code:""}),lt=t=>{const r=t.code!==""?S(t.code,t.options):"";return navigator.clipboard.writeText(r),t};addEventListener("load",()=>{const t={code:"",options:{minify:!1,skipFirstLAMBDA:!0}};et({node:document.querySelector("#app"),init:t,view:r=>v("main",{id:"app"},v("section",null,v("textarea",{id:"code",title:"code",placeholder:"code",value:r.code,wrap:"off",oninput:ct})),v("section",null,v("textarea",{id:"formula",title:"formula",placeholder:"formula",value:r.code!==""?S(r.code,r.options):"",readOnly:!0}),v("div",{id:"param"},v("label",null,v("input",{type:"checkbox",name:"minify",checked:r.options.minify,onchange:W}),v("span",{title:"コードを圧縮"},"minify")),v("label",null,v("input",{type:"checkbox",name:"skipFirstLAMBDA",checked:r.options.skipFirstLAMBDA,onchange:W,disabled:!r.options.minify}),v("span",{class:!r.options.minify&&"inactive",title:"最初のLAMBDA関数の引数を短縮しない"},"skipFirstLAMBDA")),v("div",null),v("span",{title:"サンプルコードの読み込み",onclick:st},"load sample"),v("button",{type:"button",title:"delete code",onclick:at},v("img",{src:"./svg/delete.svg"})),v("button",{type:"button",title:"copy",onclick:lt},v("img",{src:"./svg/copy_line.svg"})))))})});
