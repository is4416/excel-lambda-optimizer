(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const u of i.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&n(u)}).observe(document,{childList:!0,subtree:!0});function e(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(s){if(s.ep)return;s.ep=!0;const i=e(s);fetch(s.href,i)}})();var S=1,P=3,I={},T=[],d="http://www.w3.org/2000/svg",Z=r=>r,rr=T.map,X=Array.isArray,tr=typeof requestAnimationFrame<"u"?requestAnimationFrame:setTimeout,H=r=>{var t="";if(typeof r=="string")return r;if(X(r))for(var e=0,n;e<r.length;e++)(n=H(r[e]))&&(t+=(t&&" ")+n);else for(var e in r)r[e]&&(t+=(t&&" ")+e);return t},er=(r,t)=>{for(var e in{...r,...t})if(typeof(X(r[e])?r[e][0]:r[e])=="function")t[e]=r[e];else if(r[e]!==t[e])return!0},nr=(r,t=T,e)=>{for(var n=[],s=0,i,u;s<r.length||s<t.length;s++)i=r[s],u=t[s],n.push(u&&u!==!0?!i||u[0]!==i[0]||er(u[1],i[1])?[u[0],u[1],(i&&i[2](),u[0](e,u[1]))]:i:i&&i[2]());return n},_=r=>r==null?r:r.key,K=(r,t,e,n,s,i)=>{if(t==="style")for(var u in{...e,...n})e=n==null||n[u]==null?"":n[u],u[0]==="-"?r[t].setProperty(u,e):r[t][u]=e;else t[0]==="o"&&t[1]==="n"?((r.events||(r.events={}))[t=t.slice(2)]=n)?e||r.addEventListener(t,s):r.removeEventListener(t,s):!i&&t!=="list"&&t!=="form"&&t in r?r[t]=n??"":n==null||n===!1?r.removeAttribute(t):r.setAttribute(t,n)},Y=(r,t,e)=>{var n=r.props,s=r.type===P?document.createTextNode(r.tag):(e=e||r.tag==="svg")?document.createElementNS(d,r.tag,n.is&&n):document.createElement(r.tag,n.is&&n);for(var i in n)K(s,i,null,n[i],t,e);for(var u=0;u<r.children.length;u++)s.appendChild(Y(r.children[u]=q(r.children[u]),t,e));return r.node=s},b=(r,t,e,n,s,i)=>{if(e!==n)if(e!=null&&e.type===P&&n.type===P)e.tag!==n.tag&&(t.nodeValue=n.tag);else if(e==null||e.tag!==n.tag)t=r.insertBefore(Y(n=q(n),s,i),t),e!=null&&r.removeChild(e.node);else{var u,h,A,O,B=e.props,D=n.props,f=e.children,o=n.children,l=0,c=0,a=f.length-1,p=o.length-1;i=i||n.tag==="svg";for(var m in{...B,...D})(m==="value"||m==="selected"||m==="checked"?t[m]:B[m])!==D[m]&&K(t,m,B[m],D[m],s,i);for(;c<=p&&l<=a&&!((A=_(f[l]))==null||A!==_(o[c]));)b(t,f[l].node,f[l],o[c]=q(o[c++],f[l++]),s,i);for(;c<=p&&l<=a&&!((A=_(f[a]))==null||A!==_(o[p]));)b(t,f[a].node,f[a],o[p]=q(o[p--],f[a--]),s,i);if(l>a)for(;c<=p;)t.insertBefore(Y(o[c]=q(o[c++]),s,i),(h=f[l])&&h.node);else if(c>p)for(;l<=a;)t.removeChild(f[l++].node);else{for(var L={},M={},m=l;m<=a;m++)(A=f[m].key)!=null&&(L[A]=f[m]);for(;c<=p;){if(A=_(h=f[l]),O=_(o[c]=q(o[c],h)),M[A]||O!=null&&O===_(f[l+1])){A==null&&t.removeChild(h.node),l++;continue}O==null||e.type===S?(A==null&&(b(t,h&&h.node,h,o[c],s,i),c++),l++):(A===O?(b(t,h.node,h,o[c],s,i),M[O]=!0,l++):(u=L[O])!=null?(b(t,t.insertBefore(u.node,h&&h.node),u,o[c],s,i),M[O]=!0):b(t,h&&h.node,null,o[c],s,i),c++)}for(;l<=a;)_(h=f[l++])==null&&t.removeChild(h.node);for(var m in L)M[m]==null&&t.removeChild(L[m].node)}}return n.node=t},ir=(r,t)=>{for(var e in r)if(r[e]!==t[e])return!0;for(var e in t)if(r[e]!==t[e])return!0},q=(r,t)=>r!==!0&&r!==!1&&r?typeof r.tag=="function"?((!t||t.memo==null||ir(t.memo,r.memo))&&((t=r.tag(r.memo)).memo=r.memo),t):r:$(""),w=r=>r.nodeType===P?$(r.nodeValue,r):J(r.nodeName.toLowerCase(),I,rr.call(r.childNodes,w),S,r),J=(r,{key:t,...e},n,s,i)=>({tag:r,props:e,key:t,children:n,type:s,node:i}),$=(r,t)=>J(r,I,T,P,t),fr=(r,{class:t,...e},n=T)=>J(r,{...e,...t?{class:H(t)}:I},X(n)?n:[n]),sr=({node:r,view:t,subscriptions:e,dispatch:n=Z,init:s=I})=>{var i=r&&w(r),u=[],h,A,O=f=>{h!==f&&((h=f)==null&&(n=e=B=Z),e&&(u=nr(u,e(h),n)),t&&!A&&tr(B,A=!0))},B=()=>r=b(r.parentNode,r,i,i=t(h),D,A=!1),D=function(f){n(this.events[f.type],f)};return(n=n((f,o)=>typeof f=="function"?n(f(h,o)):X(f)?typeof f[0]=="function"?n(f[0],f[1]):f.slice(1).map(l=>l&&l!==!0&&(l[0]||l)(n,l[1]),O(f[0])):O(f)))(s),n};function G(r,t=[]){return r.forEach(e=>{Array.isArray(e)?G(e,t):t.push(e)}),t}const v=(r,t,...e)=>typeof r=="function"?r(t,G(e)):fr(r,t||{},G(e).map(n=>typeof n=="string"||typeof n=="number"?$(n):n)),x=(r,t)=>!0,U=(r,t)=>!1,cr=(r,t)=>r!==0,k=(r,t)=>r!==t-1,j=(r,t)=>r%2===0,ar=(...r)=>(t,e)=>r.every(n=>n(t,e)),lr=(r,t)=>{const e="=+-*/(,";for(let n=t-1;n>=0;n--)if(e.indexOf(r[n])!==-1)return r.slice(n+1,t);return null},or=(r,t)=>{let e=!1,n=0,s=t;for(;s<r.length;){const i=r[s];if(i==='"'&&(e=!e),e){s++;continue}if(i==="("&&n++,i===")"&&(n--,n===0))return r.slice(t,s+1);s++}return r.slice(t,r.length)},ur=r=>{const t=[];let e=0,n=!1,s=1;for(let i=1;i<r.length-1;i++){const u=r[i];u==='"'&&(n=!n),!n&&(u==="("&&e++,u===")"&&e--,u===","&&e===0&&(t.push(r.slice(s,i).trim()),s=i+1))}return s<r.length-1&&t.push(r.slice(s,r.length-1).trim()),t},V=(r,t)=>{let e=r,n=[],s=[];const i={EOL:`
`,indentSize:2,wrapColumn:35,spacingKeys:[{from:"=LAMBDA",to:"= LAMBDA"},{from:"===",to:" === "},{from:"!==",to:" !== "},{from:"==",to:" == "},{from:"!=",to:" != "},{from:"=+",to:" =+ "},{from:"=-",to:" =- "},{from:"=*",to:" =* "},{from:">=",to:" >= "},{from:"=>",to:" => "},{from:"<=",to:" <= "},{from:"=<",to:" =< "},{from:"<<",to:" << "},{from:">>",to:" >> "},{from:"=/",to:" =/ "},{from:"+",to:" + "},{from:"-",to:" - "},{from:"*",to:" * "},{from:"/",to:" / "},{from:"=",to:" = "},{from:"<",to:" < "},{from:">",to:" > "},{from:",",to:", "}],argRules:[{name:"LAMBDA",breakRule:U,variable:k},{name:"LET",breakRule:j,variable:ar(j,k)},{name:"IF",breakRule:cr,variable:U},{name:"MAP",breakRule:x,variable:U},{name:"REDUCE",breakRule:x,variable:U},{name:"HSTACK",breakRule:x,variable:U},{name:"INDEX",breakRule:x,variable:U}],skipFirstLAMBDA:!0,minify:!0,...t};e=(f=>{let o="",l=!1,c=0;for(;c<f.length-1;){if(f[c]==='"'&&(l=!l),l||f.slice(c,c+2)!=="//"){f[c]!==" "&&(o+=f[c]),c++;continue}const a=f.indexOf(i.EOL,c);c=a===-1?f.length:a}return o=o.split(i.EOL).map(a=>a.trim()).filter(Boolean).join(""),"="+o.slice(o.toUpperCase().indexOf("LAMBDA"))+i.EOL})(e),e=((f,o,l)=>{const c=i.argRules;let a=f,p=!1,m=i.skipFirstLAMBDA;for(let L=0;L<a.length;L++){const M=a[L];if(M==='"'&&(p=!p),p||M!=="(")continue;const R=lr(a,L)?.toUpperCase().trim();if(!R)continue;const y=or(a,L),g=c.find(F=>F.name===R);if(!g){a=a.slice(0,L-R.length)+R.toUpperCase()+a.slice(L);continue}const C=ur(y);let E=!1;const z="("+C.map((F,W)=>(g.variable(W,C.length)&&((g.name!=="LAMBDA"||!m)&&o.push(F),g.name==="LAMBDA"&&m&&l.push(F)),g.breakRule(W,C.length)&&y.length>i.wrapColumn?(E=!0,i.EOL+F):F)).join(",")+(E?i.EOL:"")+")";g.name==="LAMBDA"&&(m=!1);const Q=R.toUpperCase();a=a.slice(0,L-Q.length)+Q+z+a.slice(L+y.length)}return a})(e,s,n);const A=f=>{const o=a=>{let p=0;for(let m=0;m<a.length;m++)a[m]==="("&&p++,a[m]===")"&&(p=Math.max(0,p-1));return p>0},l=f.split(i.EOL);let c=0;return l.map(a=>{a[0]===")"&&c--;const p=" ".repeat(Math.max(0,i.indentSize*c))+a;return o(a)&&c++,p}).join(i.EOL)};i.minify||(e=A(e));const O=f=>{let o="",l=!1,c=0;for(;c<f.length;){const a=f[c];a==='"'&&(l=!l);const p=i.spacingKeys.find(m=>f.length-c<m.from.length?!1:f.slice(c,c+m.from.length)===m.from);l||!p?(o+=a,c++):(o+=p.to,c=c+p.from.length)}return o};i.minify||(e=O(e));const B=(f,o)=>{let l="",c=!1,a=0;const p=" =+-*/,(){}<>"+i.EOL,m=y=>{for(let g=y;g<f.length;g++){const C=f[g];if(p.indexOf(C)!==-1)return f.slice(y,g)}return f.slice(y,f.length)},L=y=>{let g=y+1,C="";for(;g>0;)g--,C=String.fromCharCode(65+g%26)+C,g=Math.floor(g/26);return C},R=(()=>{const y=[],g=new Set(n.map(C=>C.toUpperCase()));for(let C=0,E;C<o.length;C++)for(E=0;;){const z=L(C+E);if(!g.has(z)){y.push(z),g.add(z);break}E++}return y})();for(;a<f.length;){const y=f[a],g=a===0?" ":f[a-1];if(y==='"'&&(c=!c),c||p.indexOf(g)===-1){l+=y,a++;continue}const C=m(a),E=o.indexOf(C);E!==-1?(l+=R[E],a+=o[E].length):(l+=y,a++)}return l};i.minify&&(e=B(e,s));const D=f=>{let o="";for(let l=0,c=!1;l<f.length;l++){const a=f[l];a==='"'&&(c=!c),(c||a!==i.EOL)&&(o+=a)}return o};return i.minify&&(e=D(e)),e},mr=r=>[r,async t=>{const e=await fetch("./sampleCode.txt").then(n=>{if(!n.ok)throw new Error("errorr loadText");return n.text()});t(n=>({...n,code:e}))}],pr=(r,t)=>{const e=t.currentTarget;return e?{...r,code:e.value}:r},N=(r,t)=>{const e=t.currentTarget;return e?{...r,options:{...r.options,[e.name]:e.checked}}:r},hr=r=>({...r,code:""}),gr=r=>{const t=r.code!==""?V(r.code,r.options):"";return navigator.clipboard.writeText(t),r};addEventListener("load",()=>{const r={code:"",options:{minify:!1,skipFirstLAMBDA:!0}};sr({node:document.querySelector("#app"),init:r,view:t=>v("main",{id:"app"},v("section",null,v("textarea",{id:"code",title:"code",placeholder:"code",value:t.code,wrap:"off",oninput:pr})),v("section",null,v("textarea",{id:"formula",title:"formula",placeholder:"formula",value:t.code!==""?V(t.code,t.options):"",readOnly:!0}),v("div",{id:"param"},v("label",null,v("input",{type:"checkbox",name:"minify",checked:t.options.minify,onchange:N}),v("span",{title:"コードを圧縮"},"minify")),v("label",null,v("input",{type:"checkbox",name:"skipFirstLAMBDA",checked:t.options.skipFirstLAMBDA,onchange:N,disabled:!t.options.minify}),v("span",{class:!t.options.minify&&"inactive",title:"最初のLAMBDA関数の引数を短縮しない"},"skipFirstLAMBDA")),v("div",null),v("span",{title:"サンプルコードの読み込み",onclick:mr},"load sample"),v("button",{type:"button",title:"delete code",onclick:hr},v("img",{src:"./svg/delete.svg"})),v("button",{type:"button",title:"copy",onclick:gr},v("img",{src:"./svg/copy_line.svg"})))))})});
