(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const f of s)if(f.type==="childList")for(const u of f.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&n(u)}).observe(document,{childList:!0,subtree:!0});function e(s){const f={};return s.integrity&&(f.integrity=s.integrity),s.referrerPolicy&&(f.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?f.credentials="include":s.crossOrigin==="anonymous"?f.credentials="omit":f.credentials="same-origin",f}function n(s){if(s.ep)return;s.ep=!0;const f=e(s);fetch(s.href,f)}})();var Z=1,q=3,z={},P=[],H="http://www.w3.org/2000/svg",Q=t=>t,K=P.map,I=Array.isArray,w=typeof requestAnimationFrame<"u"?requestAnimationFrame:setTimeout,j=t=>{var r="";if(typeof t=="string")return t;if(I(t))for(var e=0,n;e<t.length;e++)(n=j(t[e]))&&(r+=(r&&" ")+n);else for(var e in t)t[e]&&(r+=(r&&" ")+e);return r},V=(t,r)=>{for(var e in{...t,...r})if(typeof(I(t[e])?t[e][0]:t[e])=="function")r[e]=t[e];else if(t[e]!==r[e])return!0},d=(t,r=P,e)=>{for(var n=[],s=0,f,u;s<t.length||s<r.length;s++)f=t[s],u=r[s],n.push(u&&u!==!0?!f||u[0]!==f[0]||V(u[1],f[1])?[u[0],u[1],(f&&f[2](),u[0](e,u[1]))]:f:f&&f[2]());return n},D=t=>t==null?t:t.key,k=(t,r,e,n,s,f)=>{if(r==="style")for(var u in{...e,...n})e=n==null||n[u]==null?"":n[u],u[0]==="-"?t[r].setProperty(u,e):t[r][u]=e;else r[0]==="o"&&r[1]==="n"?((t.events||(t.events={}))[r=r.slice(2)]=n)?e||t.addEventListener(r,s):t.removeEventListener(r,s):!f&&r!=="list"&&r!=="form"&&r in t?t[r]=n??"":n==null||n===!1?t.removeAttribute(r):t.setAttribute(r,n)},T=(t,r,e)=>{var n=t.props,s=t.type===q?document.createTextNode(t.tag):(e=e||t.tag==="svg")?document.createElementNS(H,t.tag,n.is&&n):document.createElement(t.tag,n.is&&n);for(var f in n)k(s,f,null,n[f],r,e);for(var u=0;u<t.children.length;u++)s.appendChild(T(t.children[u]=_(t.children[u]),r,e));return t.node=s},F=(t,r,e,n,s,f)=>{if(e!==n)if(e!=null&&e.type===q&&n.type===q)e.tag!==n.tag&&(r.nodeValue=n.tag);else if(e==null||e.tag!==n.tag)r=t.insertBefore(T(n=_(n),s,f),r),e!=null&&t.removeChild(e.node);else{var u,h,C,y,B=e.props,x=n.props,i=e.children,l=n.children,o=0,a=0,c=i.length-1,p=l.length-1;f=f||n.tag==="svg";for(var m in{...B,...x})(m==="value"||m==="selected"||m==="checked"?r[m]:B[m])!==x[m]&&k(r,m,B[m],x[m],s,f);for(;a<=p&&o<=c&&!((C=D(i[o]))==null||C!==D(l[a]));)F(r,i[o].node,i[o],l[a]=_(l[a++],i[o++]),s,f);for(;a<=p&&o<=c&&!((C=D(i[c]))==null||C!==D(l[p]));)F(r,i[c].node,i[c],l[p]=_(l[p--],i[c--]),s,f);if(o>c)for(;a<=p;)r.insertBefore(T(l[a]=_(l[a++]),s,f),(h=i[o])&&h.node);else if(a>p)for(;o<=c;)r.removeChild(i[o++].node);else{for(var A={},M={},m=o;m<=c;m++)(C=i[m].key)!=null&&(A[C]=i[m]);for(;a<=p;){if(C=D(h=i[o]),y=D(l[a]=_(l[a],h)),M[C]||y!=null&&y===D(i[o+1])){C==null&&r.removeChild(h.node),o++;continue}y==null||e.type===Z?(C==null&&(F(r,h&&h.node,h,l[a],s,f),a++),o++):(C===y?(F(r,h.node,h,l[a],s,f),M[y]=!0,o++):(u=A[y])!=null?(F(r,r.insertBefore(u.node,h&&h.node),u,l[a],s,f),M[y]=!0):F(r,h&&h.node,null,l[a],s,f),a++)}for(;o<=c;)D(h=i[o++])==null&&r.removeChild(h.node);for(var m in A)M[m]==null&&r.removeChild(A[m].node)}}return n.node=r},tt=(t,r)=>{for(var e in t)if(t[e]!==r[e])return!0;for(var e in r)if(t[e]!==r[e])return!0},_=(t,r)=>t!==!0&&t!==!1&&t?typeof t.tag=="function"?((!r||r.memo==null||tt(r.memo,t.memo))&&((r=t.tag(t.memo)).memo=t.memo),r):t:J(""),N=t=>t.nodeType===q?J(t.nodeValue,t):G(t.nodeName.toLowerCase(),z,K.call(t.childNodes,N),Z,t),G=(t,{key:r,...e},n,s,f)=>({tag:t,props:e,key:r,children:n,type:s,node:f}),J=(t,r)=>G(t,z,P,q,r),rt=(t,{class:r,...e},n=P)=>G(t,{...e,...r?{class:j(r)}:z},I(n)?n:[n]),et=({node:t,view:r,subscriptions:e,dispatch:n=Q,init:s=z})=>{var f=t&&N(t),u=[],h,C,y=i=>{h!==i&&((h=i)==null&&(n=e=B=Q),e&&(u=d(u,e(h),n)),r&&!C&&w(B,C=!0))},B=()=>t=F(t.parentNode,t,f,f=r(h),x,C=!1),x=function(i){n(this.events[i.type],i)};return(n=n((i,l)=>typeof i=="function"?n(i(h,l)):I(i)?typeof i[0]=="function"?n(i[0],i[1]):i.slice(1).map(o=>o&&o!==!0&&(o[0]||o)(n,o[1]),y(i[0])):y(i)))(s),n};function Y(t,r=[]){return t.forEach(e=>{Array.isArray(e)?Y(e,r):r.push(e)}),r}const v=(t,r,...e)=>typeof t=="function"?t(r,Y(e)):rt(t,r||{},Y(e).map(n=>typeof n=="string"||typeof n=="number"?J(n):n)),nt=(t,r)=>{const e="=+-*/(,";for(let n=r-1;n>=0;n--)if(e.indexOf(t[n])!==-1)return t.slice(n+1,r);return null},it=(t,r)=>{let e=!1,n=0,s=r;for(;s<t.length;){const f=t[s];if(f==='"'&&(e=!e),e){s++;continue}if(f==="("&&n++,f===")"&&(n--,n===0))return t.slice(r,s+1);s++}return t.slice(r,t.length)},ft=t=>{const r=[];let e=0,n=!1,s=1;for(let f=1;f<t.length-1;f++){const u=t[f];u==='"'&&(n=!n),!n&&(u==="("&&e++,u===")"&&e--,u===","&&e===0&&(r.push(t.slice(s,f).trim()),s=f+1))}return s<t.length-1&&r.push(t.slice(s,t.length-1).trim()),r},S=(t,r)=>{let e=t,n=[],s=[];const f={EOL:`
`,indentSize:2,spacingKeys:[{from:"=LAMBDA",to:"= LAMBDA"},{from:"===",to:" === "},{from:"!==",to:" !== "},{from:"==",to:" == "},{from:"!=",to:" != "},{from:"=+",to:" =+ "},{from:"=-",to:" =- "},{from:"=*",to:" =* "},{from:">=",to:" >= "},{from:"=>",to:" => "},{from:"<=",to:" <= "},{from:"=<",to:" =< "},{from:"<<",to:" << "},{from:">>",to:" >> "},{from:"=/",to:" =/ "},{from:"+",to:" + "},{from:"-",to:" - "},{from:"*",to:" * "},{from:"/",to:" / "},{from:"=",to:" = "},{from:"<",to:" < "},{from:">",to:" > "},{from:",",to:", "}],argRules:[{name:"LAMBDA",breakRule:(i,l)=>!1,variable:(i,l)=>i!==l-1},{name:"LET",breakRule:(i,l)=>i%2===0,variable:(i,l)=>i%2===0&&i!==l-1},{name:"IF",breakRule:(i,l)=>i>0,variable:(i,l)=>!1},{name:"MAP",breakRule:(i,l)=>!0,variable:(i,l)=>!1},{name:"REDUCE",breakRule:(i,l)=>!0,variable:(i,l)=>!1},{name:"HSTACK",breakRule:i=>!0,variable:i=>!1}],skipFirstLAMBDA:!0,minify:!0,...r};e=(i=>{let l="",o=!1,a=0;for(;a<i.length-1;){if(i[a]==='"'&&(o=!o),o||i.slice(a,a+2)!=="//"){i[a]!==" "&&(l+=i[a]),a++;continue}const c=i.indexOf(f.EOL,a);a=c===-1?i.length:c}return l=l.split(f.EOL).map(c=>c.trim()).filter(Boolean).join(""),"="+l.slice(l.toUpperCase().indexOf("LAMBDA"))})(e),e=((i,l,o)=>{const a=f.argRules;let c=i,p=!1,m=f.skipFirstLAMBDA;for(let A=0;A<c.length;A++){const M=c[A];if(M==='"'&&(p=!p),p||M!=="(")continue;const R=nt(c,A)?.toUpperCase().trim();if(!R)continue;const O=it(c,A),g=a.find(b=>b.name===R);if(!g){c=c.slice(0,A-R.length)+R.toUpperCase()+c.slice(A);continue}const L=ft(O);let E=!1;const U="("+L.map((b,$)=>(g.variable($,L.length)&&((g.name!=="LAMBDA"||!m)&&l.push(b),g.name==="LAMBDA"&&m&&o.push(b)),g.breakRule($,L.length)?(E=!0,f.EOL+b):b)).join(",")+(E?f.EOL:"")+")";g.name==="LAMBDA"&&(m=!1);const X=R.toUpperCase();c=c.slice(0,A-X.length)+X+U+c.slice(A+O.length)}return c})(e,s,n);const C=i=>{const l=c=>{let p=0;for(let m=0;m<c.length;m++)c[m]==="("&&p++,c[m]===")"&&p--,m<c.length-1&&c[m]===")"&&"+-*/=!<>".indexOf(c[m+1])!==-1&&p++;return p>0},o=i.split(f.EOL);let a=0;return o.map(c=>{c[0]===")"&&a--;const p=" ".repeat(Math.max(0,f.indentSize*a))+c;return l(c)&&a++,p}).join(f.EOL)};f.minify||(e=C(e));const y=i=>{let l="",o=!1,a=0;for(;a<i.length;){const c=i[a];c==='"'&&(o=!o);const p=f.spacingKeys.find(m=>i.length-a<m.from.length?!1:i.slice(a,a+m.from.length)===m.from);o||!p?(l+=c,a++):(l+=p.to,a=a+p.from.length)}return l};f.minify||(e=y(e));const B=(i,l)=>{let o="",a=!1,c=0;const p=" =+-*/,(){}"+f.EOL,m=O=>{for(let g=O;g<i.length;g++){const L=i[g];if(p.indexOf(L)!==-1)return i.slice(O,g)}return i.slice(O,i.length)},A=O=>{let g=O+1,L="";for(;g>0;)g--,L=String.fromCharCode(65+g%26)+L,g=Math.floor(g/26);return L},R=(()=>{const O=[],g=new Set(n.map(L=>L.toUpperCase()));for(let L=0,E;L<l.length;L++)for(E=0;;){const U=A(L+E);if(!g.has(U)){O.push(U),g.add(U);break}E++}return O})();for(;c<i.length;){const O=i[c],g=c===0?" ":i[c-1];if(O==='"'&&(a=!a),a||p.indexOf(g)===-1){o+=O,c++;continue}const L=m(c),E=l.indexOf(L);E!==-1?(o+=R[E],c+=l[E].length):(o+=O,c++)}return o};f.minify&&(e=B(e,s));const x=i=>{let l="";for(let o=0,a=!1;o<i.length;o++){const c=i[o];c==='"'&&(a=!a),(a||c!==f.EOL)&&(l+=c)}return l};return f.minify&&(e=x(e)),e},st=t=>[t,async r=>{const e=await fetch("./sampleCode.txt").then(n=>{if(!n.ok)throw new Error("errorr loadText");return n.text()});r(n=>({...n,code:e}))}],ct=(t,r)=>{const e=r.currentTarget;return e?{...t,code:e.value}:t},W=(t,r)=>{const e=r.currentTarget;return e?{...t,options:{...t.options,[e.name]:e.checked}}:t},at=t=>({...t,code:""}),lt=t=>{const r=t.code!==""?S(t.code,t.options):"";return navigator.clipboard.writeText(r),t};addEventListener("load",()=>{const t={code:"",options:{minify:!1,skipFirstLAMBDA:!0}};et({node:document.querySelector("#app"),init:t,view:r=>v("main",{id:"app"},v("section",null,v("textarea",{id:"code",title:"code",placeholder:"code",value:r.code,wrap:"off",oninput:ct})),v("section",null,v("textarea",{id:"formula",title:"formula",placeholder:"formula",value:r.code!==""?S(r.code,r.options):"",readOnly:!0}),v("div",{id:"param"},v("label",null,v("input",{type:"checkbox",name:"minify",checked:r.options.minify,onchange:W}),v("span",{title:"コードを圧縮"},"minify")),v("label",null,v("input",{type:"checkbox",name:"skipFirstLAMBDA",checked:r.options.skipFirstLAMBDA,onchange:W,disabled:!r.options.minify}),v("span",{class:!r.options.minify&&"inactive",title:"最初のLAMBDA関数の引数を短縮しない"},"skipFirstLAMBDA")),v("div",null),v("span",{title:"サンプルコードの読み込み",onclick:st},"load sample"),v("button",{type:"button",title:"delete code",onclick:at},v("img",{src:"./svg/delete.svg"})),v("button",{type:"button",title:"copy",onclick:lt},v("img",{src:"./svg/copy_line.svg"})))))})});
